### 前言

相信很多同学看到这个标题都想在年会里中个大奖，也相信很多同学对`Electron`很感兴趣。前端不简单，早期只能涉及`网站应用`，随着时间推移和技术变革，如今前端以渗透到各大应用开发领域。就笔者而言，目前已基于`CSS/JS`开发过`网站应用`、`桌面应用`、`移动应用`、`服务应用`、`爬虫应用`、`同构应用`、`工具应用`、`脚手架应用`、`微信公众号`和`微信小程序`。相信在未来，前端能渗透到更多的应用开发领域。

首次写系列教程，也希望各位同学多多支持。虽然网上关于`Electron`的教程有不少，但大多数教程都是处于离散状态。所以笔者想从零到一带领对`Electron`感兴趣的同学基于`Electron`完成一个年会幸运抽奖桌面应用。

希望对`Electron`感兴趣的同学能学到`Electron`大法的同时，也能巩固好开发一个前端项目所需的基本素质和技巧。

### 技术选型

在移动端有`ionic`、`react-native`和`weex`三大移动端跨平台大法，也相对应`angular`、`react`和`vue`。那么在桌面端也有`electron`和`nw`两大桌面端跨平台大法。

**Electron**和**Nw**是使用`HTML`、`CSS`和`JS`构建跨平台桌面应用且集成`Node`授予网页访问底层系统权限的技术方案。

使用`electron`开发的成功案例有`VSCode`、`Atom`、`Github`、`Slack`、`WordPress`和`微信`等等。使用`nw`开发的成功案例有`钉钉`和`微信开发工具`，没几个，笔者也想不出来了。

`electron`相对于`nw`有以下优点和缺点，而`nw`快凉了，就不再探索。

- 优点
	- 核心扩展较易：基于`Node技术`开发，由于`node-gyp`逐渐人性化导致`C++`和`JS`混用较易
	- 界面定制较强：基于`Web技术`开发，GUI核心使用`Chromium`，JS引擎使用`V8`
	- 开发成本较低：熟练使用`HTML+CSS+JS`的前端开发者都能开发，结合各种UI框架省事又省心
	- 技术方案更稳：有大团队的技术支持，运行更稳定，缺陷更少，只要浏览器调试没问题基本就没问题了
	- 迭代更新更快：方便热更新，下载新代码覆盖旧代码
- 缺点
	- 运行速度较弱：应用运行起来可能会卡也可能会慢，使用了`Webkit内核`的锅，参考`Chrome浏览器`即可
	- 进程管理较傻：除了启动主进程控制整个应用，还需启动一些辅助进程完成某些工作
	- 构建包体较大：相当于打包了一整个`Chrome浏览器`，不大才怪

不多说，凡是要开发桌面应用通通选`electron`吧。

另外，Web框架选择`react`。本来笔者想选择`vue`体验最新的`vue 3`特性，但是`vue 3`正式版迟迟未出，就放弃了。还是使用平常非常喜欢的`react hooks`开发吧，爱不释手。

不想搞那些平平无奇的抽奖特效，想搞一些酷炫屌炸天的抽奖特效，就选择`three`这个WebGL框架。想制造酷炫吊炸天特效，除了`canvas`，`webgl`也能助你一臂之力。

所以本次系列教程的最终组合是`Electron + React Hooks + Three`，妥妥的。

**另外提醒一下，最好有接触过React，无经验者可到React官网稍微了解再来学习本教程会更佳。本教程是完完全全的实战教程，不会详细讲解Electron/React/Three的深入细节和某个API怎样用，若有不懂可自行百度或在底部评论等笔者解答。**

### 项目搭建

可能很多同学都会使用`Github`一些开源的骨架项目进行二次开发，这些都是基于别人业务需求的骨架项目。若是遇上一些质量比较一般的骨架项目，文件又多又乱都不知从何处下手，那就麻烦了。

所以笔者很少这样做，都是喜欢从零到一搭建项目的基本骨架，不仅锻炼自己的项目搭建能力，也能从最基础的切入点了解整个项目的开发流程。以下就从零开始一步一步搭建项目的基本骨架。

安装`create-react-app`初始化项目的基本骨架，以该骨架项目逐一完善本教程需开发的功能。

```sh
# 安装create-react-app
npm i -g create-react-app
# 初始项目
create-react-app lottery
# 进入项目
cd lottery
# 构建项目
npm start
```

在此打个小广告，笔者基于`webpack`开发了一个增强版的`webpack`，命名为`bruce-cli`。**bruce-cli**是一个`React/Vue`应用**自动化构建脚手架**，其零配置开箱即用的优点非常适合入门级、初中级、快速开发项目的前端同学使用，还可通过创建`brucerc.js`文件来覆盖其默认配置，只需专注业务代码的编写无需关注构建代码的编写，让项目结构更简洁。真正实现构建代码和业务代码的完全分离，看着简洁的目录结构可能会爱上它。

```sh
# 安装bruce-cli
npm i -g bruce-cli
# 初始项目
bruce i
# 进入项目
cd lottery
# 构建项目
bruce b
```

笔者喜欢简洁的项目目录，所以后续会基于`bruce-cli`初始化项目的基本骨架逐一完善本教程需开发的功能。哈哈，中途变卦。不过同学们使用`create-react-app`也没问题，但是`bruce-cli`的功能会更强大，后续会一一发挥出来。

### 依赖安装

接下来需安装本教程的主角`electron`，在安装过程中若不规范上网可能100%安装失败，所以安装前需填个坑。

众所周知`NPM`的服务器在国外，而某些模块的部分依赖又托管在国外某些服务器上，即使执行`npm config set registry https://registry.npm.taobao.org/`将源镜像切换到淘宝镜像，在安装过程中遇上部分依赖，其下载地址还是指向托管在国外某些服务器上的地址，导致安装依赖失败。所以需找出这些依赖的下载地址，将其切换到淘宝镜像上。

在安装`electron`前需执行以下命令方可安装。若对解决这些镜像问题感兴趣，可回顾笔者发表的[《NPM镜像那些险象环生的坑》](https://mp.weixin.qq.com/s/9DJKOGYiv7JqqlltPipVqg)，让你彻底摆脱所有`NPM安装依赖`的坑。

```sh
# 切换淘宝镜像
npm config set registry https://registry.npm.taobao.org/
npm config set disturl https://npm.taobao.org/mirrors/node/
npm config set electron_mirror https://npm.taobao.org/mirrors/electron/
# 安装electron
yarn add electron
```

### 进程管理

`electron`可让我们使用`JS`调用丰富的`原生操作系统API`创造桌面应用。可把它看作是一个`Node环境`的变体，只是它专注于桌面应用，而`Node`专注于服务应用。

这不意味着`electron`是一个单调的`GUI`库。相反，`electron`使用`Web`渲染图形用户界面，使用`Node`授予网页访问底层系统权限，所以可把它看作是一个被`JS`控制的精简版`Chrome浏览器`。

上述分析中可知`electron`的精华，**使用Web渲染图形用户界，使用Node授予网页访问底层系统权限**。因此派生出两个主要概念，**主进程**和**渲染进程**。

### 页面运行

### 入口确定

在根目录下创建一个`main.js`，在`package.json`中加入以下配置。

```json
{
    "main": "main.js"
}
```

### 总结

- 官网地址：[https://yangzw.vip/lottery](https://yangzw.vip/lottery)
- 项目地址：[https://github.com/JowayYoung/lottery](https://github.com/JowayYoung/lottery)
- `bruce-cli`项目地址：[https://github.com/JowayYoung/bruce-cli](https://github.com/JowayYoung/bruce-cli)
- `bruce-cli`文档地址：[https://yangzw.vip/source?id=bruce-cli](https://yangzw.vip/source?id=bruce-cli)